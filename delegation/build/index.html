



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A hands-on workshop to learn about a variety of AWS identity topics.">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/aws-favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.2">
    
    
      
        <title>構築フェーズ - Identity Round Robin</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../stylesheets/custom.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
  Copyright (c) 2016-2018 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->
<header class="md-header" data-md-component="header">

    <!-- Top-level navigation -->
    <nav class="md-header-nav md-grid">
      <div class="md-flex">
  
        <!-- Link to home -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <a href="https://aws.amazon.com/"
              title="Amazon Web Services"
              class="md-header-nav__button md-logo">
            
              <img src="../../assets/images/aws_smile_logo.png" width="40" height="24" />
            
          </a>
        </div>
  
        <!-- Button to toggle drawer -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <label class="md-icon md-icon--menu md-header-nav__button"
              for="__drawer"></label>
        </div>
  
        <!-- Header title -->
        <div class="md-flex__cell md-flex__cell--stretch">
          <div class="md-flex__ellipsis md-header-nav__title"
              data-md-component="title">
            
              
                <span class="md-header-nav__topic">
                  Identity Round Robin
                </span>
                <span class="md-header-nav__topic">
                  構築フェーズ
                </span>
              
            
          </div>
        </div>
  
        <!-- Button to open search dialogue -->
        <div class="md-flex__cell md-flex__cell--shrink">
          
            
              <label class="md-icon md-icon--search md-header-nav__button"
                  for="__search"></label>
  
              <!-- Search interface -->
              
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
            
          
        </div>
        <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-flex__ellipsis md-header-nav__lang">
                <div class="md-lang-drop">
                    <button onclick="window.location.href='https://awssecworkshops.com/'" class="md-lang-dropbtn fa fa-home"></button>
                    <!--
                    <div id="mdDropMenu" class="md-dropdown-content">
                        <a href="#">JP</a>
                    </div>
                    -->
                </div>
            </div>
        </div>
  
        <!-- Repository containing source -->
        
          <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-header-nav__source">
              


  

<a href="https://github.com/skiritan/aws-identity-round-robin-workshop/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
     skiritan/aws-identity-round-robin-workshop
  </div>
</a>
            </div>
          </div>
        
      </div>
    </nav>
  </header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="概要" class="md-tabs__link">
        概要
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../serverless/" title="サーバレスアイデンティティ" class="md-tabs__link">
          サーバレスアイデンティティ
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="アクセス委任" class="md-tabs__link md-tabs__link--active">
          アクセス委任
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../permission-boundaries/" title="パーミッションバウンダリー" class="md-tabs__link">
          パーミッションバウンダリー
        </a>
      
    </li>
  

      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <!--
  Copyright (c) 2016-2019 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Main navigation -->
<nav class="md-nav md-nav--primary" data-md-level="0">

  <!-- Site title -->
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.."
        title="Identity Round Robin" class="md-nav__button md-logo">
      
        <img src="../../assets/images/aws_smile_logo.png" width="48" height="48" />
      
    </a>
    Identity Round Robin
  </label>

  <!-- Repository containing source -->
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/skiritan/aws-identity-round-robin-workshop/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
     skiritan/aws-identity-round-robin-workshop
  </div>
</a>
    </div>
  

  <!-- Render item list -->
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="概要" class="md-nav__link">
      概要
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      サーバレスアイデンティティ
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        サーバレスアイデンティティ
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/" title="シナリオ" class="md-nav__link">
      シナリオ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/task1/" title="タスク１" class="md-nav__link">
      タスク１
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/task2/" title="タスク２" class="md-nav__link">
      タスク２
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      アクセス委任
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        アクセス委任
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="シナリオ" class="md-nav__link">
      シナリオ
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        構築フェーズ
      </label>
    
    <a href="./" title="構築フェーズ" class="md-nav__link md-nav__link--active">
      構築フェーズ
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#aws" title="AWS へのサインイン" class="md-nav__link">
    AWS へのサインイン
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#macie" title="Macie を有効にする" class="md-nav__link">
    Macie を有効にする
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#guardduty" title="GuardDutyを有効にする" class="md-nav__link">
    GuardDutyを有効にする
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="環境の構築" class="md-nav__link">
    環境の構築
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="ロールについて" class="md-nav__link">
    ロールについて
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="セキュリティ管理者ロールへの切り替え" class="md-nav__link">
    セキュリティ管理者ロールへの切り替え
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="セキュリティオペレーターロールのアクセス権の調整" class="md-nav__link">
    セキュリティオペレーターロールのアクセス権の調整
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../verify/" title="検証フェーズ" class="md-nav__link">
      検証フェーズ
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      パーミッションバウンダリー
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        パーミッションバウンダリー
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../permission-boundaries/" title="シナリオ" class="md-nav__link">
      シナリオ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../permission-boundaries/build/" title="構築フェーズ" class="md-nav__link">
      構築フェーズ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../permission-boundaries/verify/" title="検証フェーズ" class="md-nav__link">
      検証フェーズ
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../contribute/" title="コントリビュート" class="md-nav__link">
      コントリビュート
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#aws" title="AWS へのサインイン" class="md-nav__link">
    AWS へのサインイン
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#macie" title="Macie を有効にする" class="md-nav__link">
    Macie を有効にする
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#guardduty" title="GuardDutyを有効にする" class="md-nav__link">
    GuardDutyを有効にする
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="環境の構築" class="md-nav__link">
    環境の構築
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="ロールについて" class="md-nav__link">
    ロールについて
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="セキュリティ管理者ロールへの切り替え" class="md-nav__link">
    セキュリティ管理者ロールへの切り替え
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="セキュリティオペレーターロールのアクセス権の調整" class="md-nav__link">
    セキュリティオペレーターロールのアクセス権の調整
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/skiritan/aws-identity-round-robin-workshop/edit/master/docs/delegation/build.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="_1">アクセス 委任 ラウンド (構築フェーズ)</h1>
<table>
<thead>
<tr>
<th>重要な注意事項</th>
</tr>
</thead>
<tbody>
<tr>
<td>以下の手順に進む前に、必ず <strong><a href="../">シナリオセクション</a></strong> をお読みください。</td>
</tr>
<tr>
<td>---</td>
</tr>
<tr>
<td>AWS コンソールには、AWS 機能に関するニュースや情報が表示される場合があります。その場合はウィンドウを自由に閉じて、画面を広げてください</td>
</tr>
<tr>
<td>チームでアカウントを共有している場合、一部のサービスは一度に1人しか使用できないため、各自でコンソールを使用する必要があります。</td>
</tr>
</tbody>
</table>
<h2 id="aws">AWS へのサインイン</h2>
<p>このワークショップの実施方法に応じて、以下のドロップダウンのいずれかを展開して AWS にサインインします。  </p>
<details class="info"><summary>AWS 主催の Event Engine を利用したイベント </summary><p><p style="font-size:20px;">
  <strong>Step 1</strong> : Event Engineの一時的な資格情報を取得する
</p></p>
<ol>
<li><a href="https://dashboard.eventengine.run" target="_blank">Event Engine dashboard</a> ダッシューボードにアクセスします。</li>
<li><strong>チーム ハッシュコード</strong> を入力します。</li>
<li><strong>AWS Console</strong> をクリックします。</li>
<li>資格情報セクションの下のエクスポートコマンドをコピーします（後の手順で必要になります）。</li>
<li>Event Engine ウィンドウで <strong>コンソールを開く</strong> をクリックします。 </li>
</ol>
</details>
<details class="info"><summary>Click AWS 主催のイベント</summary><ol>
<li>
<p>ウェブブラウザの別のタブで、指示された URL に移動し、ログインします。 </p>
</li>
<li>
<p>ログイン後、AWS Account (AWS アカウント) ボックスをクリックし、その下に表示されている Account ID  (画像の赤いボックス) をクリックします。マネジメントコンソールの下にリンクが表示されるので、これをクリックして、AWS コンソールに移動します。  </p>
</li>
</ol>
<p><img alt="login-page" src="../images/login.png" /></p>
</details>
<details class="info"><summary>個人の AWS アカウントを使用している場合</summary><p>ウェブブラウザの別のタブで、https://aws.amazon.com/console にアクセスし、アカウントにログインします。</p>
</details>
<h2 id="macie">Macie を有効にする</h2>
<ol>
<li>
<p>このラボでは Macie を利用するので、まず Amazon Macie が有効になっているか確認します。メインコンソールから <strong>Macie</strong> を選択します。そうすると、新しいタブが開きます。</p>
</li>
<li>
<p>Macie コンソールで、<strong>US East（N. Virginia）</strong>リージョンを選択します。</p>
</li>
<li>
<p>Macie コンソールで、<strong>Getting Started</strong> ボタンが表示された場合は、Amazon Macie が無効になっています。その場合は、<strong>Getting Started</strong> をクリックし、リージョンにUS East（N. Virginia）が選択されていることを確認して、<strong>Enable Macie</strong> をクリックします。数秒後、Macieコンソールが表示されるので、Macieコンソールのブラウザータブを閉じます。</p>
</li>
</ol>
<h2 id="guardduty">GuardDutyを有効にする</h2>
<ol>
<li>
<p>このラボではGuardDutyも利用するので、GuardDutyを有効にします。</p>
</li>
<li>
<p>AWSコンソールに戻ります（必要に応じてアカウントに再度サインインします）。メインコンソールから<strong>GuardDuty</strong>を選択します。</p>
</li>
<li>
<p><strong>今すぐ始める</strong> ボタンが表示されたら、クリックします。  </p>
</li>
<li>
<p>リージョンがバージニア北部に設定されていない場合は、リージョンを <strong>バージニア北部</strong> を選択します。</p>
</li>
<li>
<p><strong>GuardDutyの有効化</strong> をクリックします。</p>
</li>
</ol>
<h2 id="_2">環境の構築</h2>
<ol>
<li>
<p><strong>新しいブラウザタブ</strong> で次の <strong>Deploy to AWS</strong> リンクを開き、us-east-1 リージョンにロギング環境をデプロイします  :  <a href="https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/new?stackName=esslab&amp;templateURL=https://s3.amazonaws.com/sa-security-specialist-workshops-us-east-1/identity-workshop/essround/EssInitAccount.yaml"><img alt="Deploy IamEssInitAccount.yaml in us-east-1" src="../images/deploy-to-aws.png" /></a></p>
</li>
<li>
<p>スタックの作成 ページが表示されます。<strong>次へ</strong> をクリックします。</p>
</li>
<li>
<p>スタックの詳細を指定 ページには値が自動的に入力されています。<strong>次へ</strong> をクリックします。</p>
</li>
<li>
<p>スタックオプション ページで、<strong>次へ</strong> をクリックします。</p>
</li>
<li>
<p>レビュー ページで、<strong>IAMリソース作成についての承認</strong> チェックボックスをオンにし、<strong>スタックの作成</strong> をクリックします<br />
CloudFormation がリソース作成を開始します。<strong>この作成には約 5 分かかります</strong>。ブラウザウィンドウを更新して進捗状況を確認し、<strong>esslab</strong> スタックのステータス値に <strong>CREATE_COMPLETE</strong> が表示されるまで待機します。</p>
</li>
<li>
<p><strong>esslab</strong> の CloudFormation スタックの <strong>出力</strong> を確認してください。以下の図のようになります。</p>
<p><img alt="Account output" src="../images/IamEssOutputStack.png" /></p>
<p><em>LoggingBucketName</em> は、AWS CloudTrail がログを配信するバケット名です。後ほど参照できるように、この値をテキストエディタ等にコピーしておきます。</p>
<p><em>SecAdministratorRoleURL</em> は、後ほどのラボで一時的にセキュリティ管理者ロールに「切り替える」 (セキュリティ管理者のアクセス権限を取得する) ために使用する URL です。このロールには AWS CloudTrail、Amazon GuardDuty、Amazon Inspector、Amazon Macie に対する完全な管理権限があります。</p>
<p><em>SecOperatorRoleURL</em> は、後ほどのラボで一時的にセキュリティオペレーターロールに「切り替える」ために使用する URL です。このロールのポリシーを後ほど変更して、AWS CloudTrail、Amazon GuardDuty、Amazon Inspector、Amazon Macie の「読み取り専用」の権限のみを持つようにします。</p>
</li>
<li>
<p>CloudTrail のログ保存の設定を見てみましょう。CloudTrail の情報を S3 バケットに収集する上で最も重要なことは、S3 バケットに適切なアクセス権が設定されていることです。</p>
<p>S3 コンソールに移動し、手順 6 でメモした <em>LoggingBucketName</em> のバケットをクリックした後、<strong>アクセス権限</strong> をクリックし、<strong>バケットポリシー</strong> をクリックします。このポリシーにより、CloudTrail サービスで <em>LoggingBucket</em> の ACL を読み取ることができ、さらには AWS アカウント ID を含むプレフィックスを持つログを作成することもできるようになっています。このポリシーの詳細については この<a href="https://docs.aws.amazon.com/awscloudtrail/latest/userguide/create-s3-bucket-policy-for-cloudtrail.html">リンク</a>を参照してください。</p>
</li>
<li>
<p><strong>概要</strong> タブをクリックし、<strong>AWSLogs</strong> フォルダをクリックします。そうすると、以下に示すようにアカウントの AWS アカウント ID が表示されます。</p>
<p><img alt="LoggingBucket" src="../images/IamEssBucket.png" /></p>
<p>これは、アカウントのAWS CloudTrailログがS3バケットに到達し始めたことを示しています。ログが表示されるまでに最大5分かかる場合があります。さらに年、月、日ごとのディレクトリに移動してログを確認できます。ログは「.gz」（gzip）形式で保存されます。ファイル解凍ツールがあり、これらのログファイルの中身を確認したい場合は、お使いのワークステーションにダウンロードしてアーカイブを展開してみてください。繰り返しますが、ログが表示されるまでに数分かかる場合があります。</p>
</li>
</ol>
<h2 id="_3">ロールについて</h2>
<p>ロールとは、複数のポリシーおよび信頼関係を含む、セキュリティプリンシパル、アクターです。ユーザー、アプリケーション、AWS のサービスは、ロールに関連付けられたアクセス権を代わりに使用するため、そのロールを<em>引き受ける</em>ことができます。<em>ポリシー</em>は、ロールが実行できる AWS アクションを定義します。<em>信頼関係</em>によって、ロールを引き受けることができるユーザーが定義されます。</p>
<p>先ほど作成した CloudFormation スタックでは 2 つのロールが作成されました。1 つは、CloudTrail、GuardDuty、Inspector、Macie へのフルアクセス権を持つセキュリティ管理者ロールです。もう 1 つは、それらのサービスへの読み取り専用のアクセス権を持つセキュリティオペレーターロールです (このロールは、後ほど変更を加えて完成します)。これからセキュリティ管理者ロールに切り替えますが、その前に、ロールに関連付けらた権限を確認し、どのように動作するかを確認していきます。</p>
<ol>
<li>
<p>IAM コンソールに移動し、左側にある <strong>ロール</strong> を選択し、文字列 <em>SecAdministrator</em> を検索します。ブラウザの検索機能することも、検索ボックスに「<em>SecAdministrator</em>」と入力して検索することもできます。検索されたロールをクリックします。
    ポリシー定義は以下の図のようになります  </p>
<p><img alt="SecAdministratorRolePolicy" src="../images/IamEssSecAdminPolicy.png" /></p>
<p>すべてのポリシーを表示するために、<strong>さらに表示</strong> をクリックします。このロールには 6つのマネージドポリシーが含まれており、そのうちの 5 つは AWS が GuardDuty、Inspector、CloudTrail、IAM、SNS 用に提供しているものです。このラボでは SNS と IAM を直接操作することはありませんが、コンソールの操作性向上のためにそれらのポリシーも含まれています。</p>
<p>Amazon Macie のための 6 番目のマネージドポリシーは、カスタムマネージドポリシーの作成方法について説明するためのものです。各マネージドポリシーをクリックして、それぞれの権限を確認してください。Amazon EFS (Elastic File System) など、このポリシーでは許可されてないサービスもあることにも注意してください。この許可されていないアクセス権については、ワークショップの後半で確認します。  </p>
</li>
<li>
<p>ロールの概要ページで、<strong>信頼関係</strong> タブをクリックします。ページには信頼できるエンティティ (ロールを引き受けることができるエンティティ) のセクションがあり、以下のような12 桁の AWS アカウント ID が表示さています。これは、このアカウントのプリンシパルであればこのロールを引き受けることができることを意味しています。</p>
<p><img alt="SecAdministratorTrustRel" src="../images/IamEssAdminTrustRel.png" /></p>
</li>
<li>
<p>信頼関係の設定の中身は JSON ポリシードキュメントです。<strong>信頼関係の編集</strong> をクリックすると、以下のようなポリシーが表示されます。</p>
<p><img alt="SecAdministratorTrustRel" src="../images/IamEssAdminTrustPol.png" /></p>
<p>プリンシパルエントリには、「：root」で終わる値が表示されます。これは、アカウント自体を参照する特別なプリンシパル識別子です。このポリシーは、アカウントのすべてのプリンシパル（ユーザー、ロールなど）が sts：AssumeRole アクションを使用してロールのIDを取得することを許可することを示しています。プリンシパル識別子の詳細については、<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_identifiers.html">こちら</a>をご覧ください。</p>
<p>STS とは <em>Security Token Service</em> の略です。アクセスキーとシークレットアクセスキーを含むロールのセキュリティポリシーに関連付けられた API が呼び出されると、サービスに関連付けられた AssumeRole API によって、一時的な認証情報が作成されます。アプリケーションはこのセキュリティトークンを使用して、ロールに定義されたポリシーを使用して他の AWS API を呼び出します。</p>
</li>
</ol>
<h2 id="_4">セキュリティ管理者ロールへの切り替え</h2>
<p>ここでは、AWS コンソールでロールを切り替える方法について説明します。ロールを切り替えると、AWS コンソールの権限を別のロールに含まれる権限に一時的に置き換えることができます。このラボでは、自分の AWS アカウントのロールに切り替えます。他の AWS アカウントのロールに切り替えて、自分のアカウント以外のリソースにアクセスすることもできます。これは、<em>クロスアカウントアクセス</em>と呼ばれます。（このラボではクロスアカウントアクセスは行いません）</p>
<p>ロールを切り替えるには2つの方法があります。コンソールから自分のアカウント名をドロップダウンし[スイッチロール]をクリックする方法。または、切り替えを行うURLを使用する方法です。今回は両方の方法を使用してみます。  </p>
<ol>
<li>
<p>CloudFormation コンソールに移動し、構築した <em>esslab</em> という名前の CloudFormation スタックの <strong>出力</strong> タブを表示します。</p>
</li>
<li>
<p><em>SecAdministratorRoleURL</em> の隣にある URL をクリックします。（この URL を表示するには下にスクロールする必要がある場合があります） 新しいブラウザタブウィンドウが開き、以下のような画面が表示されます。</p>
<p><img alt="SecAdministratorRole" src="../images/IamEssSwitchSecAdminRole.png" /></p>
<p>ボックスには、アカウント ID (AWS アカウントの ID)、CloudFormation によって作成されたロール名、および表示名が含まれます。切り替えるロールの表示色も選択することもできます。</p>
<p><strong>ロールの切り替え</strong> をクリックします。</p>
<p>下記のように、コンソールウィンドウの上部に <em>SecAdministrator</em> という名前の新しいロールラベルが表示されます。これは、 SecAdministrator ロールの権限が有効な権限として「一時的に」置き換えられたことを意味しています</p>
<p><img alt="SecAdministratorLabel" src="../images/IamEssSwitchSecAdminRolePost.png" /></p>
<p>では、セキュリティ管理者としてどのような権限があるか、各サービスに順番にアクセスして確認していきます。</p>
</li>
<li>
<p>Amazon EFS コンソールに移動します。コンソールにアクセスできないことを示すメッセージが表示されます。これは、このロールのポリシーが Amazon EFS へのアクセスを許可していないためです。</p>
<p><img alt="EFSConsole" src="../images/IamEssEFSConsole.png" /></p>
</li>
<li>
<p>Amazon Inspector コンソールに移動します。Inspectorの管理権限があることを確認するために、既存のテンプレートのクローンを作成してみます。<strong>評価テンプレート</strong> をクリックし、<em>LampInspectorAssessmentTemplate</em> で始まるテンプレート名を選択して <strong>クローン</strong> をクリックします。フォームのセクションが表示されるので、下にスクロールダウンし[ <strong>作成</strong> ]ボタンをクリックします。画面を更新すると、<em>LampInspectorAssessment</em> で始まる2つのテンプレートが表示され、[名前] を広げると、新しくクローンが作成されていることがわかります。評価テンプレートを正常に複製できたことで、Inspector の管理アクセス権限を持っていることが確認できました。</p>
</li>
<li>
<p><strong>GuardDuty コンソール</strong> に移動し、<strong>設定</strong> メニュー項目を選択します。<strong>結果のエクスポートオプション</strong> の <strong>更新された結果の頻度</strong> という名前のフィールドまでスクロールし、値を[<strong>1時間ごとに CWE と S3 を更新する</strong> ]に変更し、<strong>保存</strong> をクリックします。ウィンドウの上部に、設定が保存されたことを示すメッセージが表示されます。これは、GuardDutyに完全にアクセスできることを示しています。</p>
</li>
<li>
<p><strong>Macie コンソール</strong>に移動し、<strong>US East (N. Virginia)</strong> リージョンを選択して、<strong>Settings</strong> をクリックし、<strong>Content Type</strong>アイコンをクリックします。そうすると、ファイルタイプのリストが表示されます。<em>application/cap</em> などのファイルタイプの編集ボタン(鉛筆マーク) をクリックして、<em>Enabled</em> フラグの値を <strong><em>No-disabled</em></strong>  に変更して<strong>Save</strong> します。これは同様に、Macie への管理アクセス権があることを示しています。Macie ウィンドウを閉じます。</p>
</li>
<li>
<p>GuardDuty を作業したブラウザータブに戻り、CloudTrail コンソールに移動します。</p>
</li>
<li>
<p><strong>証跡情報</strong> をクリックし、名前が <em>esslab</em> で始まる証跡をクリックします。</p>
</li>
<li>
<p>画面右上の <strong>ログ記録</strong> スイッチを OFF (オフ) にすると、確認メッセージが表示されるので <strong>次へ</strong> をクリックします。さらに、 <strong>ログ記録</strong> を ON (オン) に戻します。これにより、CloudTrail への管理アクセス権があることが確認できます。</p>
</li>
<li>
<p>Inspector、Macie、GuardDuty、および CloudTrail への管理アクセス権があることを確認が終了しました。以前のロールに戻るために、SecAdministrator ラベルをクリックし、メニューの右下にある <strong>…..</strong><strong>に戻る</strong> を選択します。（コンソールにはロールの履歴が保持されるため、後でロールを簡単に切り替えることができます）</p>
<p><img alt="SwitchBacktoAdmin" src="../images/IamSwitchFromSecAdmin.png" /></p>
<p>通常のロールに戻ると、SecAdministrator のロールラベルは表示されなくなります。</p>
</li>
</ol>
<h2 id="_5">セキュリティオペレーターロールのアクセス権の調整</h2>
<p>セキュリティ管理者ロールに切り替える方法を確認したので、次はセキュリティオペレーターロールのアクセス権限を変更して、Macie、GuardDuty、Inspector、および CloudTrail へのアクセス権を読み取り専用にしていきます。</p>
<ol>
<li>
<p>IAM コンソールで、<strong>ロール</strong> を選択し、<em>SecOperator</em> を検索します。表示されたロールをクリックします。ロールには、以下ようなアクセス権が与えられています。</p>
<p><img alt="SecOperPolicy" src="../images/IamEssSecOperPolicy.png" /></p>
</li>
<li>
<p>繰り返しになりますが、5 つのマネージドポリシー (Inspector、GuardDuty、CloudTrail、IAM、SNS 用の 5つの AWS マネージドポリシーと、Macie 用のカスタムマネージドポリシー) があることを確認してください。Inspector、GuardDuty、CloudTrail のマネージドポリシーは、サービスへのフルアクセス権を提供していますが、Macie ポリシー (名前に <em>SecOperatorMaciePolicy</em> が含まれるもの) は、その名前にもかかわらず、Macie へのフルアクセス権を提供しています。</p>
</li>
<li>
<p>赤い矢印で示す X 印をクリックして、AmazonCloudTrailFullAccess、AmazonGuardDutyFullAccess、および AmazonInspectorFullAccess ポリシーを削除します。Inspector、CloudTrail、GuardDuty への読み取り専用のアクセスポリシーを追加します。また、SecOperatorMacie ポリシーを変更して、Macie への読み取り専用のアクセス権を提供するようにします。</p>
<p>手順は記載していません。ヒントが必要な場合は、以下のドロップダウンを開いてください。</p>
<p><details>
<summary><strong>ここをクリックしてヒントを表示</strong></summary><p>
<br/></p>
<p>情報のリンクを記載します。新しいブラウザタブで以下のリンクを開いて確認してください。</p>
<p><a href="https://docs.aws.amazon.com/awscloudtrail/latest/userguide/control-user-permissions-for-cloudtrail.html">Amazon CloudTrail のアクセス権限の管理</a></p>
<p><a href="https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_managing_access.html">Amazon GuardDuty のアクセス権限の管理</a></p>
<p><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/list_amazoninspector.html">Amazon Inspector のアクセス権限の管理</a></p>
<p><a href="https://docs.aws.amazon.com/macie/latest/userguide/macie-access-control.html">Controlling access to Amazon Macie</a></p>
</details>

</li>
<li>
<p>CloudFormation コンソールに移動し、以前構築した <em>esslab</em> という名前の CloudFormation スタックの出力タブを表示します。</p>
</li>
<li>
<p>SecOperatorRoleURL の隣にある URL をクリックします。新しいブラウザタブウィンドウが開き、以下のように表示されます。</p>
<p><img alt="SecOperatorRole" src="../images/IamEssSwitchSecOperRole.png" /></p>
<p>ボックスには、アカウント ID (AWS アカウントの ID)、CloudFormation によって作成されたロール名、および表示名が含まれます。切り替えるロールの表示色も選択することもできます。</p>
<p><strong>ロールの切り替え</strong> をクリックします。</p>
<p>下記のように、コンソールウィンドウの上部に <em>SecOperator</em> という名前の新しいロールラベルが表示されます。これは、 <em>SecOperator</em> ロールの権限が有効な権限として「一時的に」置き換えられたことを意味しています</p>
<p><img alt="SecOperatorLabel" src="../images/IamEssSwitchSecOperRolePost.png" /></p>
<p>では同様に、セキュリティオペレーターとしてどのような権限があるか、各サービスに順番にアクセスして確認していきます。</p>
</li>
<li>
<p>Amazon Inspector コンソールに移動します。<strong>評価テンプレート</strong> をクリックし、<em>LampInspectorAssessmentTemplate</em> で始まるテンプレートの左にあるボックスを<strong>両方</strong>選択して <strong>削除</strong> をクリックします。削除の確認に <strong>はい</strong> をクリックします。数秒後に、inspector：DeleteAssessmentTemplateアクションを呼び出す権限がないことを示すエラーメッセージが表示されます。</p>
</li>
<li>
<p>GuardDuty コンソールに移動し、<strong>設定</strong> をクリックし、<strong>更新された結果の頻度</strong> フィールドを別の値に変更し、<strong>保存</strong> をクリックします。UpdateDetector アクションを実行する権限がないことを示すエラーメッセージが表示されます (スクロールして表示する必要がある場合があります) 。これは、GuardDuty への読み取り専用のアクセス権しかないためです。</p>
</li>
<li>Macie コンソールに移動し、US East (N. Virginia) リージョンを選択して、<strong>Settings</strong> をクリックし、<strong>Content Type</strong>アイコンをクリックします。そうすると、ファイルタイプのリストが表示されます。<em>application/cap</em> などのファイルタイプを選択し、選択したファイルタイプを編集して <em>Enabled</em>  フラグの値を変更し、<strong>Save</strong> をクリックします。Macie への読み取り専用のアクセス権しかないため、エラーメッセージが表示されます。Macie ウィンドウを閉じます。</li>
<li>GuardDuty を作業したブラウザータブに戻り、そこから CloudTrail コンソールに移動します。</li>
<li><strong>証跡情報</strong> をクリックし、名前が <em>esslab</em> で始まる証跡をクリックします。</li>
<li>画面右上の <strong>ログ記録</strong> スイッチを OFF (オフ) に切り替え、<strong>次へ</strong> をクリックします。CloudTrail への読み取り専用のアクセス権しかないため、エラーメッセージが表示されます。</li>
<li>ここで、デフォルトのロールに戻ります。そうすると、SecOperator ロールラベルはコンソールに表示されなくなります。</li>
<li>ワークショップをチームの一員を実施している場合、時間があれば、他のチームにアカウント認証情報を渡して、次の<a href="../verify/">検証フェーズ</a> で他のチームの設定を確認してみてください。それ以外の場合は、<a href="../verify/">検証フェーズ</a> の<strong>クリーンアップセクション</strong>まで進んでください。</li>
</ol>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../" title="シナリオ" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                シナリオ
              </span>
            </div>
          </a>
        
        
          <a href="../verify/" title="検証フェーズ" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                検証フェーズ
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://awssecworkshops.com" class="md-footer-social__link fa fa-home"></a>
    
      <a href="https://aws.amazon.com/security/" class="md-footer-social__link fa fa-shield"></a>
    
      <a href="https://twitter.com/awssecurityinfo?lang=en" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://aws.amazon.com/blogs/security/" class="md-footer-social__link fa fa-rss"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.d9aa80ab.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>