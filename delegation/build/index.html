



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A hands-on workshop to learn about a variety of AWS identity topics.">
      
      
        <link rel="canonical" href="https://identity-round-robin.awssecworkshops.com/delegation/build/">
      
      
        <meta name="author" content="aws-security-workshops@amazon.com">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/aws-favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.2">
    
    
      
        <title>Build Phase - Identity Round Robin</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../stylesheets/custom.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#access-delegation-round-build-phase" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
  Copyright (c) 2016-2018 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->
<header class="md-header" data-md-component="header">

    <!-- Top-level navigation -->
    <nav class="md-header-nav md-grid">
      <div class="md-flex">
  
        <!-- Link to home -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <a href="https://aws.amazon.com/"
              title="Amazon Web Services"
              class="md-header-nav__button md-logo">
            
              <img src="../../assets/images/aws_smile_logo.png" width="40" height="24" />
            
          </a>
        </div>
  
        <!-- Button to toggle drawer -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <label class="md-icon md-icon--menu md-header-nav__button"
              for="__drawer"></label>
        </div>
  
        <!-- Header title -->
        <div class="md-flex__cell md-flex__cell--stretch">
          <div class="md-flex__ellipsis md-header-nav__title"
              data-md-component="title">
            
              
                <span class="md-header-nav__topic">
                  Identity Round Robin
                </span>
                <span class="md-header-nav__topic">
                  Build Phase
                </span>
              
            
          </div>
        </div>
  
        <!-- Button to open search dialogue -->
        <div class="md-flex__cell md-flex__cell--shrink">
          
            
              <label class="md-icon md-icon--search md-header-nav__button"
                  for="__search"></label>
  
              <!-- Search interface -->
              
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
            
          
        </div>
        <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-flex__ellipsis md-header-nav__lang">
                <div class="md-lang-drop">
                    <button onclick="window.location.href='https://awssecworkshops.com/'" class="md-lang-dropbtn fa fa-home"></button>
                    <!--
                    <div id="mdDropMenu" class="md-dropdown-content">
                        <a href="#">JP</a>
                    </div>
                    -->
                </div>
            </div>
        </div>
  
        <!-- Repository containing source -->
        
          <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-header-nav__source">
              


  

<a href="https://github.com/aws-samples/aws-identity-round-robin-workshop/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    aws-samples/aws-identity-round-robin-workshop
  </div>
</a>
            </div>
          </div>
        
      </div>
    </nav>
  </header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="Overview" class="md-tabs__link">
        Overview
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../serverless/" title="Serverless Identity Round" class="md-tabs__link">
          Serverless Identity Round
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="Access Delegation Round" class="md-tabs__link md-tabs__link--active">
          Access Delegation Round
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../permission-boundaries/" title="Permission Boundary Round" class="md-tabs__link">
          Permission Boundary Round
        </a>
      
    </li>
  

      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <!--
  Copyright (c) 2016-2019 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Main navigation -->
<nav class="md-nav md-nav--primary" data-md-level="0">

  <!-- Site title -->
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://identity-round-robin.awssecworkshops.com/"
        title="Identity Round Robin" class="md-nav__button md-logo">
      
        <img src="../../assets/images/aws_smile_logo.png" width="48" height="48" />
      
    </a>
    Identity Round Robin
  </label>

  <!-- Repository containing source -->
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/aws-samples/aws-identity-round-robin-workshop/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    aws-samples/aws-identity-round-robin-workshop
  </div>
</a>
    </div>
  

  <!-- Render item list -->
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Serverless Identity Round
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Serverless Identity Round
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/" title="Scenario" class="md-nav__link">
      Scenario
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/task1/" title="Task 1" class="md-nav__link">
      Task 1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/task2/" title="Task 2" class="md-nav__link">
      Task 2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Access Delegation Round
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Access Delegation Round
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Scenario" class="md-nav__link">
      Scenario
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Build Phase
      </label>
    
    <a href="./" title="Build Phase" class="md-nav__link md-nav__link--active">
      Build Phase
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sign-in-to-aws" title="Sign in to AWS" class="md-nav__link">
    Sign in to AWS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-macie" title="Enable Macie" class="md-nav__link">
    Enable Macie
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-guardduty" title="Enable GuardDuty" class="md-nav__link">
    Enable GuardDuty
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-out-the-environment" title="Build out the environment" class="md-nav__link">
    Build out the environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-roles" title="Understanding Roles" class="md-nav__link">
    Understanding Roles
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#switching-to-the-security-administrator-role" title="Switching to the Security Administrator role" class="md-nav__link">
    Switching to the Security Administrator role
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refine-the-security-operator-role-permissions" title="Refine the Security Operator role permissions" class="md-nav__link">
    Refine the Security Operator role permissions
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../verify/" title="Verify Phase" class="md-nav__link">
      Verify Phase
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Permission Boundary Round
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Permission Boundary Round
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../permission-boundaries/" title="Scenario" class="md-nav__link">
      Scenario
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../permission-boundaries/build/" title="Build Phase" class="md-nav__link">
      Build Phase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../permission-boundaries/verify/" title="Verify Phase" class="md-nav__link">
      Verify Phase
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../contribute/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sign-in-to-aws" title="Sign in to AWS" class="md-nav__link">
    Sign in to AWS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-macie" title="Enable Macie" class="md-nav__link">
    Enable Macie
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-guardduty" title="Enable GuardDuty" class="md-nav__link">
    Enable GuardDuty
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-out-the-environment" title="Build out the environment" class="md-nav__link">
    Build out the environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-roles" title="Understanding Roles" class="md-nav__link">
    Understanding Roles
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#switching-to-the-security-administrator-role" title="Switching to the Security Administrator role" class="md-nav__link">
    Switching to the Security Administrator role
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refine-the-security-operator-role-permissions" title="Refine the Security Operator role permissions" class="md-nav__link">
    Refine the Security Operator role permissions
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aws-samples/aws-identity-round-robin-workshop/edit/master/docs/delegation/build.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="access-delegation-round-build-phase">Access Delegation Round (Build Phase)</h1>
<table>
<thead>
<tr>
<th>IMPORTANT NOTE!</th>
</tr>
</thead>
<tbody>
<tr>
<td>Please make sure you have read the <strong><a href="../">scenario section</a></strong> before continuing below.</td>
</tr>
</tbody>
</table>
<h2 id="sign-in-to-aws">Sign in to AWS</h2>
<p>Depending on how you're doing this workshop, expand one of the following dropdowns to sign into AWS.</p>
<details class="info"><summary>AWS-sponsored event</summary><ol>
<li>
<p>In a separate tab in your web browser, go to the URL provided to you and login. </p>
</li>
<li>
<p>After you login click the <strong>AWS Account</strong> box, then click on the Account ID displayed below that (the red box in the image.) You should see a link below that for the <strong>Management console</strong>. Click on that and you will be taken to the AWS console. </p>
</li>
</ol>
<p><img alt="login-page" src="../images/login.png" /></p>
</details>
<details class="info"><summary>Individual or an event not sponsored by AWS</summary><p>In a separate tab in your web browser, go to https://aws.amazon.com/console and log into your account.</p>
</details>
<h2 id="enable-macie">Enable Macie</h2>
<ol>
<li>
<p>You will need Macie for this lab so you must make sure Amazon Macie is running.
Select <strong>Macie</strong> from the main console.
Macie will open in a new browser tab.</p>
</li>
<li>
<p>Select the us-west (Oregon) region in the Macie console.</p>
</li>
<li>
<p>When the Macie console appears, if a <strong>Getting Started</strong> button appears, it means that Amazon Macie is disabled.
In that case, click <strong>Getting Started</strong>, confirm that US West (Oregon) is selected as the region, and click <strong>Enable Macie</strong>.
Close the browser tab containing the Macie console.</p>
</li>
</ol>
<h2 id="enable-guardduty">Enable GuardDuty</h2>
<ol>
<li>
<p>You will also need GuardDuty for this lab so you will now enable GuardDuty.
Select <strong>GuardDuty</strong> from the main console.  If you see a <strong>Get Started</strong> button, click it.</p>
</li>
<li>
<p>If the region is not set to Oregon, select Oregon for the region.</p>
</li>
<li>
<p>Click <strong>Enable GuardDuty</strong>.</p>
</li>
</ol>
<h2 id="build-out-the-environment">Build out the environment</h2>
<ol>
<li>
<p>Return to the AWS Console, sigining into the account again if necessary.</p>
</li>
<li>
<p>Open the <strong>Deploy to AWS</strong> link that follows in a new browser tab to deploy the logging environment in the us-west-2 region:  <a href="https://console.aws.amazon.com/cloudformation/home?region=us-west-2#/stacks/new?stackName=esslab&amp;templateURL=https://s3.amazonaws.com/sa-security-specialist-workshops-us-west-2/identity-workshop/essround/EssInitAccount.yaml"><img alt="Deploy IamEssInitAccount.yaml in us-west-2" src="../images/deploy-to-aws.png" /></a></p>
</li>
<li>
<p>In the new browser tab that you just opened, you will see the Select Template page.  Click <strong>Next</strong>.</p>
</li>
<li>
<p>On the Specify Details/Parameters page, the values have been filled in for you.  Click <strong>Next</strong>.</p>
</li>
<li>
<p>On the Options page, click <strong>Next</strong>.</p>
</li>
<li>
<p>On the Review page, check the <strong>I acknowledge</strong> box and click <strong>Create</strong>.
The acknowledgement is requested because of the creation of resources with custom names.
The CloudFormation template does this when it creates certain resources with names that make it easier to identify them.</p>
<p>CloudFormation will now begin to create the resources.
<strong>Refresh the browser window to view the progress.</strong>
This takes about five minutes.
Wait until the Status value for the <strong>esslab</strong> stack shows <strong>CREATE_COMPLETE</strong>.
You can refresh the browser window to update the status.</p>
<p>Click on the dropdown below to learn more.</p>
<p><details>
<summary><strong>Click here to expand</strong></summary><p>
<br/></p>
<ul>
<li>
<p>The CloudFormation template launches an Amazon EC2 instance that wil be used as a target for Amazon Inspector.</p>
</li>
<li>
<p>The EC2 instance will then initiate an Amazon Inspector assessment run.  The assessment takes about 15-20 minutes to complete.  Note that there at times may be no findings.  This is typically the case when a new AMI is released.</p>
</li>
</ul>
</details>

</li>
<li>
<p>Take a look at the outputs for the <strong>esslab</strong> CloudFormation stack.  They will look similar to the picture below.</p>
<p><img alt="Account output" src="../images/IamEssOutputStack.png" /></p>
<p>The output value assigned to <em>LoggingBucketName</em>  is the name of the bucket into which AWS CloudTrail will deliver its logs.  Copy the value of <em>LoggingBucketName</em> to a scratch file on your workstation so you have it available later.</p>
<p>The value assigned to <em>SecAdministratorRoleURL</em> is a URL that you will use later in the lab to temporarily "switch to" (meaning take on the access privileges of) a Securty Administrator role.   This role has full administrative privileges for AWS CloudTrail, Amazon GuardDuty, Amazon Inspector, and Amazon Macie.</p>
<p>The value assigned to <em>SecOperatorRoleURL</em> is a URL that you will use later in the lab to temporarily "switch to" a Securty Operator role.   You will later modify the policy associated with this role so it only has "read only" privileges for AWS CloudTrail, Amazon GuardDuty, Amazon Inspector, and Amazon Macie.</p>
</li>
<li>
<p>Let's take a look at CloudTrail logging.  The most important part of collecting AWS CloudTrail information into an Amazon S3 bucket is setting the correct permissions on the Amazon S3 bucket.</p>
<p>Go to the S3 console, check the box next to the bucket with the name assigned to <em>LoggingBucketName</em> which you note in Step 7, click on <strong>Permissions</strong>, and then Click on <strong>Bucket Policy</strong>.  Note that the policy allows the CloudTrail service to read the ACL of the <em>LoggingBucket</em> and also to create logs with prefixes containing the AWS account ID. you can read more about this policy at this <a href="https://docs.aws.amazon.com/awscloudtrail/latest/userguide/create-s3-bucket-policy-for-cloudtrail.html">link</a>.</p>
</li>
<li>
<p>Go to the S3 console, check the box next to the bucket with the name <em>LoggingBucketName</em>.  Click on <strong>Properties</strong>. Now click the <strong>Overview</strong> tab and then click the <strong>AWSLogs</strong> folder prefix.
You should then see the AWS account ID of your account as shown below.</p>
<p><img alt="LoggingBucket" src="../images/IamEssBucket.png" /></p>
<p>This shows that AWS CloudTrail logs for your account have started to make their way to the S3 bucket.
It may take up to five minutes for logs to start appearing.</p>
</li>
</ol>
<h2 id="understanding-roles">Understanding Roles</h2>
<p>A role is a security principal, an actor, that has a set of policies and a trust relationship.  A user, an application, or an AWS service can <em>assume</em> the role in order to subsititute its own access privileges for those associated with the role.  The <em>policies</em> define what AWS actions the role can perform.  The <em>trust relationshop</em> defines who is allowed to assume the role.</p>
<p>The CloudFormation stack you just built created two roles. One role is for a Security Administrator who has full access to CloudTrail, GuardDuty, Inspector, and Macie.  The other role is for a Security Operator who, after changes you make later on, will have read-only access to these services.  You are going to switch to the Security Administrator role but before doing so, let's look at the privileges associated with that role so you can see what it does.</p>
<ol>
<li>
<p>Go to the IAM console, select <strong>Roles</strong> on the left and search for the string <em>SecAdministrator</em>.  You can search either by using your browser's search capability or you can type <em>SecAdministrator</em> into the search box.  Click on the role that you retrieve.
The policy definition will be similar to the image below.</p>
<p><img alt="SecAdministratorRolePolicy" src="../images/IamEssSecAdminPolicy.png" /></p>
<p>There are six managed policies attached to this role, four of them are provided by AWS for GuardDuty, Inspector, CloudTrail, IAM, and SNS.  SNS and IAM are included because it provides for a better console experience.  There is a sixth managed policy that was created for Amazon Macie to illustrate how custom managed poicies can be developed.   Click on each of the managed policies to see the underlying privileges of each.  Note that there are some services, such as Amazon EFS (Elastic File System), that are not granted by any of these policies.  You will confirm this lack of access later in this workshop.</p>
</li>
<li>
<p>From the main page of the role, click the <strong>Trust relationships</strong> tab.  You will see a section on the page telling you that the trusted entity (the entity that can assume the role) is the 12-digit AWS account ID as shown below.  This means that any principal in the account can assume the role.</p>
<p><img alt="SecAdministratorTrustRel" src="../images/IamEssAdminTrustRel.png" /></p>
</li>
<li>
<p>The internal representation of the trust relatioship is a JSON policy document.  Click <strong>Show policy document</strong>.  You will see a policy similar to that shown in the picture below.</p>
<p><img alt="SecAdministratorTrustRel" src="../images/IamEssAdminTrustPol.png" /></p>
<p>This policy says that every principal in the account is allowed to use the sts:AssumeRole action to take on the identity of the role.  STS stands for <em>Security Token Service</em>.  The AssumeRole API associated with the service creates temporary credentials when you call the API that are associated with the security policies of the role including an access key and a secret access key.  Your application then uses these security tokens to make calls to other AWS APIs with the policies defined in the role.</p>
</li>
</ol>
<h2 id="switching-to-the-security-administrator-role">Switching to the Security Administrator role</h2>
<p>You are now going to learn about how to switch to a new role in the AWS console.
Switching to a new role allows you to temporarily <em>substitute</em> your AWS console permissions for those contained in another role.
In this lab, you will be switching to roles that are in your own AWS account.
You can also switch to roles in other AWS accounts to gain access to resources in accounts other than your own.
This is known as <em>cross-account access</em>.
You will not be doing <em>cross-account access</em> in this lab.</p>
<ol>
<li>
<p>Go to the CloudFormation console and view the outputs tab of the CloudFormation stack named <em>esslab</em> you just built.</p>
</li>
<li>
<p>Click on the URL next to <em>SecAdministratorRoleURL</em>.  You may need to scroll down to see it.
A new browser tab window will appear showing information similar to the image below.</p>
<p><img alt="SecAdministratorRole" src="../images/IamEssSwitchSecAdminRole.png" /></p>
<p>The box contains the account ID (which is the ID of your AWS account), a role name that was created by CloudFormation, and a Display Name.
You can also select a color that will be used to display the role you assume in the console.</p>
<p>Click <strong>Switch Role</strong>.</p>
<p>You will now see a new role label named <em>SecAdministrator</em> in the top of your console window as shown below.</p>
<p><img alt="SecAdministratorLabel" src="../images/IamEssSwitchSecAdminRolePost.png" /></p>
<p>This means that your <em>effective</em> privileges have been <em>temporarily</em> replaced with those of the SecAdministrator role.</p>
</li>
<li>
<p>Go to the Amazon EFS console.  Notice that you get a message telling you that you do not have access to any of the features of the console.  This is because none of the underlying policies grant any access to any part of Amazon EFS.</p>
<p><img alt="EFSConsole" src="../images/IamEssEFSConsole.png" /></p>
</li>
<li>
<p>Now go to the Amazon Inspector Console.  Click <strong>Assessment Templates</strong> and check the box to the left of the template name that begins with <em>LampInspectorAssessmentTemplate</em> and click <strong>Clone</strong>.  A section of the form will appear.  Scroll down towards the bottom and click the <strong>Create</strong> button.   Refresh the screen.  You should now see two templates that begin with <em>LampInspectorAssessment</em>.  You have just successfully cloned an assessment template which shows that you have administrative access privileges for Inspector.</p>
</li>
<li>
<p>Now go to the GuardDuty console and select the Settings menu item.  You may see an error message at the top of the screen about <strong>iam:ListPolicyVersions</strong>.  The reason for this is that you do not have full IAM permissions.  Ignore this message.</p>
<p>To verify that you do have administrative capabilities for GuardDuty, scroll down to the field named <em>Updated findings</em> and change the value to <strong>Send notification every 1 hour</strong> and click <strong>Save settings</strong> at the bottom of the window (you may need to scroll down further).
You will see a message at the top of your window (you may need to scroll up) saying that the settings have been saved.  This shows you do have full access to <em>GuardDuty</em>.</p>
</li>
<li>
<p>Go to the Macie console, select the US West (Oregon) region, click Settings, and click on the Content Type icon.
You will see a list of file types appear.
Pick a file type such as <em>application/cap</em>, click the edit widget (it looks like a pencil), change the value of the <em>Enabled</em> flag to <em>No - disabled</em>.
This shows that you have administrative access to Macie.
Close the Macie window.</p>
</li>
<li>
<p>Go back to the console session that you had for GuardDuty and from there go to the CloudTrail console.</p>
</li>
<li>
<p>Click <strong>Trails</strong> and then click the trail whose name begins with <em>esslab</em>.</p>
</li>
<li>
<p>Toggle the Logging switch to OFF.  You will be asked to confirm.  Click <strong>Continue</strong>.  Now toggle Logging back to ON.
This shows that you have administrative access to CloudTrail.</p>
</li>
<li>
<p>Now that you have confirmed that you have administrative access to Inspector, Macie, GuardDuty, and CloudTrail, you no longer need your temporary permissions.
Click on the SecAdministrator label and select <strong>Back to</strong> on the bottom right of the menu as shown below.  Also note that the console maintains a role history to make it easier for you to switch back to the SecAdministrator role later.</p>
<p><img alt="SwitchBacktoAdmin" src="../images/IamSwitchFromSecAdmin.png" /></p>
<p>After you switch back to your regular role the special role label for SecAdministrator is no longer displayed.</p>
</li>
</ol>
<h2 id="refine-the-security-operator-role-permissions">Refine the Security Operator role permissions</h2>
<p>Now that you know how to switch to the Security Administrator role, you are going to make some changes to the permissions for the Security Operator role so that it only has read-only access to Macie, GuardDuty, Inspector, and CloudTrail.</p>
<ol>
<li>
<p>Go to the IAM console, select <strong>Roles</strong> and search for <em>SecOperator</em>.
Click on the resulting role that you see.
The role will have permissions similar to those shown in the picture below.</p>
<p><img alt="SecOperPolicy" src="../images/IamEssSecOperPolicy.png" /></p>
</li>
<li>
<p>Notice that there are once again five managed policies, four AWS-managed policies for Inspector, GuardDuty, CloudTrail, and SNS, and a custom managed policy for Macie.
The managed policies for Inspector, GuardDuty, and CloudTrail still provide full access to the services.  The SNS policy has already been changed to provide read-only access to SNS.
The Macie policy (whose name contains <em>SecOperatorMaciePolicy</em>), despite its name, still provides full access to Macie.</p>
</li>
<li>
<p>Remove the AmazonCloudTrailFullAccess, AmazonGuardDutyFullAccess, and Amazon InspectorFullAccess policies by click on the removal crosses as shown by the arrows.
Add read-only access policies for Inspector, CloudTrail, and GuardDuty.
Also modify the SecOperatorMacie policy so that it provides read-only access to Macie.</p>
<p>If you need some hints, open the dropdown below.</p>
<p><details>
<summary><strong>Click here to expand</strong></summary><p>
<br/></p>
<p>Here are some links that offer information that may be helpful to you.  Open them in a <em>new</em> browser tab for more information.</p>
<p><a href="https://docs.aws.amazon.com/awscloudtrail/latest/userguide/control-user-permissions-for-cloudtrail.html">Controlling access to Amazon CloudTrail</a></p>
<p><a href="https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_managing_access.html">Controlling access to Amazon GuardDuty</a></p>
<p><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/list_amazoninspector.html">Controlling access to Amazon Inspector</a></p>
<p><a href="https://docs.aws.amazon.com/macie/latest/userguide/macie-access-control.html">Controlling access to Amazon Macie</a></p>
</details>

</li>
<li>
<p>Go to the CloudFormation console and view the outputs tab of the CloudFormation stack named <em>esslab</em> you built earlier.</p>
</li>
<li>
<p>Click on the URL next to SecOperatorRoleURL.
A new browser tab window will appear showing information similar to the image below.</p>
<p><img alt="SecOperatorRole" src="../images/IamEssSwitchSecOperRole.png" /></p>
<p>The box contains the account ID (which is the ID of your AWS account), a role name that was created by CloudFormation, and a Display Name.
You can also select a color that will be used to display the role you assume in the console.</p>
<p>Click <strong>Switch Role</strong>.</p>
<p>You will now see a new role label named <em>SecAdministrator</em> in the top of your console window as shown below.</p>
<p><img alt="SecOperatorLabel" src="../images/IamEssSwitchSecOperRolePost.png" /></p>
<p>This means that your <em>effective</em> privileges have been <em>temporarily</em>  replaced with those of the SecOperator role.</p>
</li>
<li>
<p>Now go to the Amazon Inspector Console.  Click <strong>Assessment Templates</strong> and check the box to the left of both of the template name that begins with <em>LampInspectorAssessmentTemplate</em> and click <strong>Delete</strong>.  You will be asked to confirm the deletion.  Click <strong>Yes</strong>.  After 30 or so seconds you will see an error message telling you that you are not authorized to call the inspector:DeleteAssessmentTemplate action.  This is because you have read-only access to Inspector.</p>
</li>
<li>
<p>Now go to the GuardDuty console, click <strong>Settings</strong>, change the <strong>Updated findings</strong> field to a different value, and click <strong>Save settings</strong>.  You will see an error message telling you that you are not authorized to perform the UpdateDetector action (the message may appear beneath the first IAM error message).  This is because you have read-only access to GuardDuty.</p>
</li>
<li>
<p>Go to the Macie console, select the US West (Oregon) region, click on <strong>Settings</strong> and click on the Content Type icon.
You will see a list of file types appear.
Pick a file type such as <em>application/cap</em>, edit it and change the value of the <em>Enabled</em> flag and click <strong>Save</strong>.
You will receive an error message because you have read-only access to Macie.
Close the Macie window.</p>
</li>
<li>
<p>Go back to the console session that you had for GuardDuty and from there go to the CloudTrail console.</p>
</li>
<li>
<p>Click <strong>Trails</strong> and click the trail whose name begins with <em>esslab</em>.</p>
</li>
<li>
<p>Toggle the Logging switch to OFF.  Click <strong>Continue</strong>.  You will receive an error message because you have read-only access to CloudTrail.</p>
</li>
<li>
<p>Now switch back to your default role.
After you to this the SecOperator role label will no longer appear on your console.</p>
</li>
<li>
<p>If you doing this workshop as part of a team, you will pass your account credentials to another team that will verify the configuration of your roles.
Click <a href="../verify/">here</a> to proceed to the Verify Phase.</p>
</li>
</ol>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../" title="Scenario" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Scenario
              </span>
            </div>
          </a>
        
        
          <a href="../verify/" title="Verify Phase" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Verify Phase
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://awssecworkshops.com" class="md-footer-social__link fa fa-home"></a>
    
      <a href="https://aws.amazon.com/security/" class="md-footer-social__link fa fa-shield"></a>
    
      <a href="https://twitter.com/awssecurityinfo?lang=en" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://aws.amazon.com/blogs/security/" class="md-footer-social__link fa fa-rss"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.d9aa80ab.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>