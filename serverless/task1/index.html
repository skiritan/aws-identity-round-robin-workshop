



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A hands-on workshop to learn about a variety of AWS identity topics.">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/aws-favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.2">
    
    
      
        <title>タスク１ - Identity Round Robin</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../stylesheets/custom.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#1" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
  Copyright (c) 2016-2018 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->
<header class="md-header" data-md-component="header">

    <!-- Top-level navigation -->
    <nav class="md-header-nav md-grid">
      <div class="md-flex">
  
        <!-- Link to home -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <a href="https://aws.amazon.com/"
              title="Amazon Web Services"
              class="md-header-nav__button md-logo">
            
              <img src="../../assets/images/aws_smile_logo.png" width="40" height="24" />
            
          </a>
        </div>
  
        <!-- Button to toggle drawer -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <label class="md-icon md-icon--menu md-header-nav__button"
              for="__drawer"></label>
        </div>
  
        <!-- Header title -->
        <div class="md-flex__cell md-flex__cell--stretch">
          <div class="md-flex__ellipsis md-header-nav__title"
              data-md-component="title">
            
              
                <span class="md-header-nav__topic">
                  Identity Round Robin
                </span>
                <span class="md-header-nav__topic">
                  タスク１
                </span>
              
            
          </div>
        </div>
  
        <!-- Button to open search dialogue -->
        <div class="md-flex__cell md-flex__cell--shrink">
          
            
              <label class="md-icon md-icon--search md-header-nav__button"
                  for="__search"></label>
  
              <!-- Search interface -->
              
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
            
          
        </div>
        <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-flex__ellipsis md-header-nav__lang">
                <div class="md-lang-drop">
                    <button onclick="window.location.href='https://awssecworkshops.com/'" class="md-lang-dropbtn fa fa-home"></button>
                    <!--
                    <div id="mdDropMenu" class="md-dropdown-content">
                        <a href="#">JP</a>
                    </div>
                    -->
                </div>
            </div>
        </div>
  
        <!-- Repository containing source -->
        
          <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-header-nav__source">
              


  

<a href="https://github.com/skiritan/aws-identity-round-robin-workshop/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
     skiritan/aws-identity-round-robin-workshop
  </div>
</a>
            </div>
          </div>
        
      </div>
    </nav>
  </header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="概要" class="md-tabs__link">
        概要
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="サーバレスアイデンティティ" class="md-tabs__link md-tabs__link--active">
          サーバレスアイデンティティ
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../delegation/" title="アクセス委任" class="md-tabs__link">
          アクセス委任
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../permission-boundaries/" title="パーミッションバウンダリー" class="md-tabs__link">
          パーミッションバウンダリー
        </a>
      
    </li>
  

      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <!--
  Copyright (c) 2016-2019 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Main navigation -->
<nav class="md-nav md-nav--primary" data-md-level="0">

  <!-- Site title -->
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.."
        title="Identity Round Robin" class="md-nav__button md-logo">
      
        <img src="../../assets/images/aws_smile_logo.png" width="48" height="48" />
      
    </a>
    Identity Round Robin
  </label>

  <!-- Repository containing source -->
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/skiritan/aws-identity-round-robin-workshop/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
     skiritan/aws-identity-round-robin-workshop
  </div>
</a>
    </div>
  

  <!-- Render item list -->
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="概要" class="md-nav__link">
      概要
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      サーバレスアイデンティティ
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        サーバレスアイデンティティ
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="シナリオ" class="md-nav__link">
      シナリオ
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        タスク１
      </label>
    
    <a href="./" title="タスク１" class="md-nav__link md-nav__link--active">
      タスク１
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#s3" title="構築フェーズ  S3オリジンの攻撃対象となりうる箇所を減らす" class="md-nav__link">
    構築フェーズ  S3オリジンの攻撃対象となりうる箇所を減らす
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" title="既存ポリシーの確認" class="md-nav__link">
    既存ポリシーの確認
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" title="プリンシパルの変更" class="md-nav__link">
    プリンシパルの変更
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="アクションの変更" class="md-nav__link">
    アクションの変更
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" title="新しいバケットポリシーのテスト" class="md-nav__link">
    新しいバケットポリシーのテスト
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="残された問題への対応" class="md-nav__link">
    残された問題への対応
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#s3_1" title="検証フェーズ  S3オリジンの攻撃対象となりうる箇所を減らす" class="md-nav__link">
    検証フェーズ  S3オリジンの攻撃対象となりうる箇所を減らす
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../task2/" title="タスク２" class="md-nav__link">
      タスク２
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      アクセス委任
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        アクセス委任
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../delegation/" title="シナリオ" class="md-nav__link">
      シナリオ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../delegation/build/" title="構築フェーズ" class="md-nav__link">
      構築フェーズ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../delegation/verify/" title="検証フェーズ" class="md-nav__link">
      検証フェーズ
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      パーミッションバウンダリー
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        パーミッションバウンダリー
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../permission-boundaries/" title="シナリオ" class="md-nav__link">
      シナリオ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../permission-boundaries/build/" title="構築フェーズ" class="md-nav__link">
      構築フェーズ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../permission-boundaries/verify/" title="検証フェーズ" class="md-nav__link">
      検証フェーズ
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../contribute/" title="コントリビュート" class="md-nav__link">
      コントリビュート
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#s3" title="構築フェーズ  S3オリジンの攻撃対象となりうる箇所を減らす" class="md-nav__link">
    構築フェーズ  S3オリジンの攻撃対象となりうる箇所を減らす
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" title="既存ポリシーの確認" class="md-nav__link">
    既存ポリシーの確認
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" title="プリンシパルの変更" class="md-nav__link">
    プリンシパルの変更
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="アクションの変更" class="md-nav__link">
    アクションの変更
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" title="新しいバケットポリシーのテスト" class="md-nav__link">
    新しいバケットポリシーのテスト
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="残された問題への対応" class="md-nav__link">
    残された問題への対応
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#s3_1" title="検証フェーズ  S3オリジンの攻撃対象となりうる箇所を減らす" class="md-nav__link">
    検証フェーズ  S3オリジンの攻撃対象となりうる箇所を減らす
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/skiritan/aws-identity-round-robin-workshop/edit/master/docs/serverless/task1.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="1">サーバーレス アイデンティティ ラウンド <small>タスク 1</small></h1>
<p>あなたは、チームのセキュリティタスクを担当者として、WildRydes アプリケーションの 2 つのタスクを実行していきます。以下の手順をすすめてタスクを完了させてください。</p>
<h2 id="s3">構築フェーズ  <small>S3オリジンの攻撃対象となりうる箇所を減らす</small></h2>
<p>アプリケーションは CloudFront ディストリビューション経由でコンテンツを配信しています。攻撃対象となりうる箇所を減らすため、エンドユーザーは CloudFront の URL 経由で<strong>のみ</strong>アクセス可能とし、Amazon S3 の URL には直接アクセスできないよう設定を変更してください。またこの設定変更によって、エンドユーザーがアプリケーションの可用性や整合性に影響を与えないようにしてください。  </p>
<div class="admonition info">
<p class="admonition-title">セキュリティ上の利点</p>
<ul>
<li>S3 オリジンを難読化する</li>
<li>カスタム証明書を使用し、強制的に HTTPS トラフィックを利用するようにする</li>
<li>アプリケーションに DDoS 保護を追加し、将来的に <a href="https://aws.amazon.com/waf/" target="_blank">AWS WAF</a> や <a href="https://aws.amazon.com/shield/" target="_blank">AWS Shield</a> を使用できるようにする</li>
</ul>
</div>
<h3 id="_1">既存ポリシーの確認</h3>
<p>まず、既存の S3 バケットポリシーを表示し、前任のエンジニアが作成したアクセス権を確認します。</p>
<ol>
<li><a href="https://s3.console.aws.amazon.com/s3/home" target="_blank">Amazon S3</a> コンソールに移動します。  </li>
<li><strong>identity-wksp-serverless-&lt;<em>ACCOUNT#</em>>-us-east-1-wildrydes</strong> バケットをクリックします。  .</li>
<li><strong>アクセス権限</strong> タブをクリックし、<strong>バケットポリシー</strong> をクリックします。</li>
</ol>
<div class="admonition question">
<p class="admonition-title">このポリシーのどこが間違っているのでしょうか？ <code>"Principal": "*"</code> はどういう意味でしょうか? </p>
<p><code>"Principal": "*"</code> および <code>"Principal":{"AWS":"*"}</code> の両方とも、全員にアクセス権を付与しています (匿名アクセスとも呼ばれます)。S3 バケットへの匿名アクセスを許可する場合は注意が必要です。匿名アクセスを許可すると、世界中の誰もがこのバケットにアクセス可能です。S3 バケットへの匿名書き込みアクセス権は許可しないことを強くお勧めします。</p>
</div>
<h3 id="_2">プリンシパルの変更</h3>
<p>現在の設定では匿名アクセスが許可されているため、これを変更して CloudFront ディストリビューションからのアクセスのみを許可する必要があります。</p>
<ol>
<li><a href="https://console.aws.amazon.com/cloudfront/" target="_blank">Amazon CloudFront</a> コンソールに移動します。WildRydes ウェブアプリケーションのウェブディストリビューションが表示されます。</li>
<li>
<p>左のナビゲーションで <strong>Origin Access Identities (オリジンアクセスアイデンティティ)</strong> をクリックします。<strong>Unicorn OAI</strong> というアイデンティティが表示されます。 </p>
<div class="admonition info">
<p class="admonition-title">CloudFront オリジンアクセスアイデンティティ</p>
<p>オリジンアクセスアイデンティティ (OAI) とは、AWS IAM を使用してアクセスを制限することができる、ディストリビューションに関連付けることができる特別な CloudFront アイデンティティです。ウェブディストリビューションを表示して OAI を見つけることもできます。</p>
</div>
</li>
<li>
<p>ID をコピーします。</p>
</li>
<li><a href="https://s3.console.aws.amazon.com/s3/home" target="_blank">Amazon S3</a> に戻り、バケットポリシーを開きます。  </li>
<li><strong>principal</strong> を以下のように置き換えて <strong>保存</strong> をクリックします。</li>
</ol>
<div class="codehilite"><pre><span></span><span class="s2">&quot;Principal&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&quot;AWS&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:iam::cloudfront:user/CloudFront Origin Access Identity &lt;OAI ID&gt;&quot;</span>
<span class="p">}</span><span class="err">,</span>
</pre></div>


<div class="admonition info">
<p class="admonition-title">補足</p>
<p>次のように、CanonicalUser(正規ユーザー) IDをプリンシパルとして使用することもできます。"CanonicalUser": "<OAI S3CanonicalUserId>": <code>"CanonicalUser": "&lt;OAI S3CanonicalUserId&gt;"</code></p>
</div>
<h3 id="_3">アクションの変更</h3>
<p>これで、プリンシパルは CloudFront ディストリビューションに関連付けられたアイデンティティに制限されました。引き続きアクセス権を詳細に確認していきます。</p>
<ol>
<li>
<p><a href="https://s3.console.aws.amazon.com/s3/home" target="_blank">Amazon S3</a> に戻り、バケットポリシーを開いて確認します。  </p>
<div class="admonition question">
<p class="admonition-title">CloudFront には、オブジェクトを削除するアクセス権が本当に必要でしょうか？</p>
</div>
</li>
<li>
<p>ディストリビューションは静的なサイトの CDN として動作するため、必要なのは S3 バケットへの読み取りアクセスのみです。エンドユーザーがサイトの整合性に影響を与えないように、アクションを変更します。（手順は記載していません）</p>
</li>
</ol>
<h3 id="_4">新しいバケットポリシーのテスト</h3>
<p>バケットポリシーが更新されたので、S3 の URL を使用してウェブサイトに直接アクセスできないことを確認します。</p>
<ol>
<li><a href="https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks?filter=active" target="_blank">Amazon CloudFormation</a> コンソール (us-east-1) を開きます。  </li>
<li><strong>Identity-RR-Wksp-Serverless-Round</strong> スタック （または <strong>module-a7932bd25ca64049a57fd5bb055782db</strong> スタック) をクリックします。  </li>
<li><strong>出力</strong> をクリックし、<strong>WebsiteS3URL</strong> をクリックします。</li>
</ol>
<div class="admonition question">
<p class="admonition-title">まだ S3 の URL を使用してサイトにアクセスできますか？</p>
</div>
<h3 id="_5">残された問題への対応</h3>
<p>バケットポリシーを変更して、CloudFront ディストリビューションからのみの読取りアクセス許可としましたが、何らかの理由で S3 の URL を使用したアクセスができています。引き続き調査を行い、その理由を解明して、トラフィックを制限するために設定を追加してください。</p>
<div class="admonition ヒント">
<p class="admonition-title">ヒント</p>
<p>S3 には他にどのようなアクセスコントロールがあるでしょうか?  次のリソースを確認してください。</p>
<ul>
<li><a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html" target="_blank">S3 ブロックパブリックアクセスの使用</a> (最も簡単)</li>
<li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_notprincipal.html" target="_blank">AWS IAM ポリシーの要素: NotPrincipal </a> (難しい)</li>
</ul>
<p>動作確認時には、必ずキャッシュをクリアしてください。</p>
</div>
<h2 id="s3_1">検証フェーズ  <small>S3オリジンの攻撃対象となりうる箇所を減らす</small></h2>
<p>ここまでで、アプリケーションにアイデンティティコントロールが追加されたので、あなたはエンドユーザーとして手動テストを行い、コントロールが正しく導入され、要件が満たされていることを確認する必要があります。</p>
<p>アプリケーションが <em>CloudFront</em> ディストリビューション経由でコンテンツを提供すること、さらにはエンドユーザーが <em>CloudFront</em> の <em>URL</em> によってのみアプリケーションにアクセスでき、Amazon S3 の URL からはアクセスできないことを確認してください。この設定変更により、エンドユーザーがアプリケーションの可用性または整合性に影響を与えることがあってはいけません</p>
<div class="admonition tip">
<p class="admonition-title">確認チェックリスト</p>
<ul>
<li>
<p>CloudFront ディストリビューション URL (&lt;WebsiteCloudFrontURL>)からサイトにアクセスできます。</p>
</li>
<li>
<p>S3 URL (&lt;WebsiteS3URL>)経由でのアプリケーションリソースへのアクセスが制限されています。</p>
<blockquote>
<p>フォルダ以下にあるリンクも試してください (例: &lt;WebsiteS3URL>/js/vendor/unicorn-icon)</p>
</blockquote>
</li>
<li>
<p>いずれのアプリケーションも、CloudFront ディストリビューションを経由して削除または変更することはできません。</p>
<blockquote>
<p>curl や Postman などを使用して、異なる HTTP メソッド (例: Delete) でリクエストを実行してみてください。以下に、curl を使用した例を示します。   </p>
</blockquote>
<p><code>curl -i -X DELETE &lt;WebsiteCloudFrontURL&gt;/index.html</code></p>
</li>
</ul>
</div>
<hr />
<p>以上のタスクを完了したら、タスク２に進んでください。</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../" title="シナリオ" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                シナリオ
              </span>
            </div>
          </a>
        
        
          <a href="../task2/" title="タスク２" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                タスク２
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://awssecworkshops.com" class="md-footer-social__link fa fa-home"></a>
    
      <a href="https://aws.amazon.com/security/" class="md-footer-social__link fa fa-shield"></a>
    
      <a href="https://twitter.com/awssecurityinfo?lang=en" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://aws.amazon.com/blogs/security/" class="md-footer-social__link fa fa-rss"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.d9aa80ab.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>